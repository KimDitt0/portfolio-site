<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Blue Archive Style Adventure</title>

<!-- Do Hyeon 폰트 -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Do Hyeon', sans-serif;
  background: linear-gradient(135deg, #0d1b2a, #1b263b);
  color: #fff;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  position: relative;
}

/* 시작 버튼 */
#startGameBtn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  padding: 15px 25px;
  font-size: 1.2rem;
  cursor: pointer;
  border: none;
  border-radius: 10px;
  background: #4a90e2;
  color: #fff;
  z-index: 1000;
}

/* BGM 토글 */
#bgm-toggle { position: absolute; top: 15px; right: 15px; font-size: 28px; cursor: pointer; z-index:1000; }

/* 게임 UI */
.game-container {
  width: 1000px;
  height: 650px;
  background: rgba(20, 30, 50, 0.95);
  border-radius: 20px;
  display: grid;
  grid-template-columns: 180px 1fr 180px;
  grid-template-rows: 50px 180px 1fr 220px;
  gap: 10px;
  padding: 10px;
  box-sizing: border-box;
  display: none;
}

/* 구역 표시 */
#zone-display {
  grid-column: 1 / 4;
  grid-row: 1 / 2;
  text-align: center;
  font-weight: bold;
  font-size: 1.8rem; /* 폰트 크기 키움 */
}

/* 캐릭터 얼굴 */
#character-face {
  grid-column: 1 / 2;
  grid-row: 2 / 3;
  background: #1b2a41;
  border-radius: 10px;
  display: flex;
  justify-content: center;
  align-items: center;
}
#character-face img { width: 150px; height: 150px; }

/* 캐릭터 스탯 */
#character-stats {
  grid-column: 1 / 2;
  grid-row: 3 / 4;
  background: #223354;
  border-radius: 10px;
  padding: 10px;
  font-size: 0.9rem;
}

/* 몬스터 */
#monster {
  grid-column: 2 / 3;
  grid-row: 2 / 4;
  background: #000;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
#monster img { width: 250px; height: 250px; margin-bottom: 10px; }
#monster-health { width: 80%; height: 20px; background: #555; border-radius: 8px; overflow: hidden; }
#monster-health-inner { width: 100%; height: 100%; background: #e74c3c; transition: width 0.3s; }

/* 아이템 박스 */
#items {
  grid-column: 3 / 4;
  grid-row: 2 / 4;
  display: flex;
  flex-direction: column;
  gap: 10px;
  justify-content: flex-start;
  align-items: center;
  padding: 10px;
  background: #223354;
  border-radius: 10px;
}
#items-label { font-size: 1rem; font-weight: bold; margin-bottom: 10px; }
.item-slot { width: 100px; height: 100px; background: #334466; border-radius: 15px; display:flex; justify-content:center; align-items:center; }

/* 이벤트 로그 + 선택지 */
#event-log {
  grid-column: 1 / 4;
  grid-row: 4 / 5;
  background: #1b2a41;
  border-radius: 10px;
  padding: 10px;
  overflow-y: auto;
}
.message { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 5px; }
.message img { width: 30px; height: 30px; border-radius: 50%; }
.bubble { background: #223354; padding: 8px 12px; border-radius: 12px; max-width: 80%; animation: fadeIn 0.3s ease; }
.message.player { flex-direction: row-reverse; }
.message.player .bubble { background: #4a90e2; }

#choices { margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap; }
#choices button { background: #4a90e2; border: none; border-radius: 8px; padding: 8px 12px; color: white; cursor: pointer; font-weight: bold; transition: 0.2s; }
#choices button:hover { background: #357ab7; transform: translateY(-2px); }

@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<button id="startGameBtn">게임 시작</button>
<div id="bgm-toggle">🔇</div>
<audio id="bgm" src="audio/bgm.mp3" loop></audio>

<div class="game-container" id="gameContainer">
  <div id="zone-display">현재 위치: 1구역</div>

  <div id="character-face"><img src="images/player.png" alt="캐릭터"></div>
  <div id="character-stats">
    <p id="player-attack">공격: 100</p>
    <p id="player-defense">방어: 50</p>
    <p id="player-hp">체력: 300 / 350</p>
    <p>상태: 🙂</p>
  </div>

  <div id="monster">
    <img src="images/monster.png" alt="몬스터">
    <div id="monster-health"><div id="monster-health-inner"></div></div>
  </div>

  <div id="items">
    <div id="items-label">아이템</div>
    <div class="item-slot"></div>
    <div class="item-slot"></div>
    <div class="item-slot"></div>
    <div class="item-slot"></div>
  </div>

  <div id="event-log">
    <div id="log"></div>
    <div id="choices"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

const log = document.getElementById("log");
const choices = document.getElementById("choices");
const bgm = document.getElementById("bgm");
const bgmToggle = document.getElementById("bgm-toggle");
const gameContainer = document.getElementById("gameContainer");
const startBtn = document.getElementById("startGameBtn");
let isBGMPlaying = false;

// 플레이어 정보
let player = { hp: 300, maxHp: 350, attack: 100, defense: 50, zone: 1 };

// 몬스터 기본 템플릿
let monsterTemplate = { maxHp: 200, attack: 20 };
let monster = { hp: monsterTemplate.maxHp };

// 구역별 난이도
const zones = {
  1: { monsterHp: 200, monsterAtk: 20 },
  2: { monsterHp: 300, monsterAtk: 30 },
  3: { monsterHp: 400, monsterAtk: 40 }
};

// 캐릭터/NPC 이미지
const characters = { player: "images/player.png", npc: "images/npc.png" };

// 구역 표시
function setZone(currentZone){
  const zoneDisplay = document.getElementById("zone-display");
  zoneDisplay.innerText = `현재 위치: ${currentZone}구역`;
}

// 메시지 출력
function writeMessage(text, speaker="npc", imgSrc=null){
  const msgDiv = document.createElement("div");
  msgDiv.className = "message " + (speaker==="player"?"player":"");
  const img = document.createElement("img");
  img.src = imgSrc || characters[speaker];
  const bubble = document.createElement("div");
  bubble.className="bubble";
  bubble.innerText=text;
  msgDiv.appendChild(img); msgDiv.appendChild(bubble);
  log.appendChild(msgDiv);
  log.scrollTop = log.scrollHeight;
}

// 선택지 표시
function setChoices(options){
  choices.innerHTML = "";
  options.forEach(opt => {
    const btn = document.createElement("button");
    btn.innerText = opt.text;
    btn.onclick = () => { opt.action(); };
    choices.appendChild(btn);
  });
}

// BGM 토글
bgmToggle.onclick = () => {
  if(isBGMPlaying){ bgm.pause(); bgmToggle.innerText="🔇"; isBGMPlaying=false; }
  else { bgm.play().catch(()=>{}); bgmToggle.innerText="🔊"; isBGMPlaying=true; }
};

// 체력 업데이트
function updateStats(){
  document.getElementById("player-hp").innerText = `체력: ${player.hp} / ${player.maxHp}`;
  document.getElementById("monster-health-inner").style.width = `${(monster.hp / monsterTemplate.maxHp) * 100}%`;
}

// 아이템 슬롯에 장비 추가
function addItemToSlot(imgSrc){
  const itemSlots = document.querySelectorAll(".item-slot");
  for(const slot of itemSlots){
    if(!slot.innerHTML){
      const img = document.createElement("img");
      img.src = imgSrc;
      img.style.width="80px";
      img.style.height="80px";
      slot.appendChild(img);
      break;
    }
  }
}

// 랜덤 이벤트
function randomEvent(){
  const eventChance = Math.random();
  if(eventChance < 0.4){ // 상자
    writeMessage("상자를 발견했습니다! 장비를 획득했습니다.", "player", "images/box.png");
    addItemToSlot("images/equipment.png");
  } else if(eventChance < 0.7){ // 조우자
    const heal = 50;
    player.hp = Math.min(player.hp + heal, player.maxHp);
    writeMessage(`조우자를 만나 체력이 ${heal} 회복되었습니다!`, "player", "images/ally.png");
    updateStats();
  } else {
    writeMessage("이번 구역은 조용합니다...", "npc");
  }
}

// 전투 시작
function startBattle(){
  log.innerHTML = "";
  randomEvent(); // 랜덤 이벤트
  const z = player.zone;
  monsterTemplate.maxHp = zones[z].monsterHp;
  monsterTemplate.attack = zones[z].monsterAtk;
  monster.hp = monsterTemplate.maxHp;
  setZone(player.zone);
  updateStats();
  writeMessage(`구역 ${player.zone}에서 유령이 나타났습니다!`, "npc");
  setChoices([{text:"공격", action:attack},{text:"도망", action:flee}]);
}

// 공격
function attack(){
  if(player.hp<=0) return;
  let dmg = Math.max(player.attack - 20, 5);
  monster.hp -= dmg; if(monster.hp<0) monster.hp=0;
  writeMessage(`유령에게 ${dmg} 피해를 주었습니다!`, "player");
  if(monster.hp <=0){
    writeMessage("유령을 처치했습니다!", "npc");
    player.zone++;
    if(player.zone > 3){ writeMessage("모든 구역 클리어!", "npc"); player.zone=1; }
    setChoices([{text:"다음 구역 이동", action:startBattle}]);
    return;
  }
  // 몬스터 공격
  let monsterDmg = monster.attack;
  player.hp -= monsterDmg; if(player.hp<0) player.hp=0;
  writeMessage(`유령에게 ${monsterDmg} 피해를 받았습니다!`, "npc");
  updateStats();
  if(player.hp<=0){
    writeMessage("체력이 0이 되어 패배했습니다. 1구역으로 돌아갑니다.", "npc");
    player.hp = player.maxHp; player.zone = 1;
    setChoices([{text:"처음부터 다시", action:startBattle}]);
    updateStats();
  } else {
    setChoices([{text:"공격", action:attack},{text:"도망", action:flee}]);
  }
}

// 도망
function flee(){
  writeMessage("도망쳤습니다.", "player");
  setChoices([{text:"다시 전투 시작", action:startBattle}]);
}

// 게임 시작
startBtn.onclick = () => {
  gameContainer.style.display="grid";
  startBtn.style.display="none";
  if(!isBGMPlaying){ bgm.play().catch(()=>{}); bgmToggle.innerText="🔊"; isBGMPlaying=true; }
  startBattle();
};

});
</script>
</body>
</html>
