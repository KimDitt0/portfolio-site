<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Blue Archive Style Adventure</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Do Hyeon', sans-serif;
  background: linear-gradient(135deg, #0d1b2a, #1b263b);
  color: #fff;
  margin: 0; padding: 0;
  display: flex; justify-content: center; align-items: center;
  height: 100vh; position: relative;
}
#startGameBtn { position: absolute; top:50%; transform: translateY(-50%);
  padding:15px 25px; font-size:1.2rem; cursor:pointer;
  border:none; border-radius:10px; background:#4a90e2; color:#fff; z-index:1000;
}
#bgm-toggle { position:absolute; top:15px; right:15px; font-size:28px; cursor:pointer; z-index:1000; }
.game-container { display:none; width:1000px; height:650px; background:rgba(20,30,50,0.95);
  border-radius:20px; display:grid; grid-template-columns:180px 1fr 180px;
  grid-template-rows:50px 180px 1fr 220px; gap:10px; padding:10px; box-sizing:border-box;
}
#zone-display { grid-column:1/4; grid-row:1/2; text-align:center; font-weight:bold; font-size:1.8rem; }
#character-face { grid-column:1/2; grid-row:2/3; background:#1b2a41; border-radius:10px; display:flex; justify-content:center; align-items:center; }
#character-face img { width:150px; height:150px; }
#character-stats { grid-column:1/2; grid-row:3/4; background:#223354; border-radius:10px; padding:10px; font-size:0.9rem; }
#monster { grid-column:2/3; grid-row:2/4; background:#000; border-radius:10px; display:flex; flex-direction:column; justify-content:center; align-items:center; }
#monster img { width:250px; height:250px; margin-bottom:10px; }
#monster-health { width:80%; height:20px; background:#555; border-radius:8px; overflow:hidden; display:none; margin-top:10px; }
#monster-health-inner { width:100%; height:100%; background:#e74c3c; transition:width 0.3s; }
#items { grid-column:3/4; grid-row:2/4; display:flex; flex-direction:column; gap:10px; justify-content:flex-start; align-items:center; padding:10px; background:#223354; border-radius:10px; }
#items-label { font-size:1rem; font-weight:bold; margin-bottom:10px; }
.item-slot { width:100px; height:100px; background:#334466; border-radius:15px; display:flex; justify-content:center; align-items:center; }
#event-log { grid-column:1/4; grid-row:4/5; background:#1b2a41; border-radius:10px; padding:10px; overflow-y:auto; }
.message { display:flex; align-items:flex-start; gap:10px; margin-bottom:5px; }
.message img { width:30px; height:30px; border-radius:50%; }
.bubble { background:#223354; padding:8px 12px; border-radius:12px; max-width:80%; animation:fadeIn 0.3s ease; }
.message.player { flex-direction:row-reverse; }
.message.player .bubble { background:#4a90e2; }
#choices { margin-top:10px; display:flex; gap:10px; flex-wrap:wrap; }
#choices button { background:#4a90e2; border:none; border-radius:8px; padding:8px 12px; color:white; cursor:pointer; font-weight:bold; transition:0.2s; }
#choices button:hover { background:#357ab7; transform:translateY(-2px); }
@keyframes fadeIn { from{opacity:0; transform:translateY(5px);} to{opacity:1; transform:translateY(0);} }
.blink { animation: blink 0.6s ease infinite alternate; }
@keyframes blink { from{filter: brightness(1);} to{filter: brightness(1.8);} }
</style>
</head>
<body>

<button id="startGameBtn">게임 시작</button>
<div id="bgm-toggle">🔇</div>
<audio id="bgm" src="audio/bgm.mp3" loop></audio>

<div class="game-container" id="gameContainer">
  <div id="zone-display">현재 위치: 1구역</div>
  <div id="character-face"><img src="images/player.png" alt="캐릭터"></div>
  <div id="character-stats">
    <p id="player-attack">공격: 100</p>
    <p id="player-defense">방어: 50</p>
    <p id="player-hp">체력: 300 / 350</p>
    <p>상태: 🙂</p>
  </div>
  <div id="monster">
    <img src="images/monster.png" alt="몬스터">
    <div id="monster-health"><div id="monster-health-inner"></div></div>
  </div>
  <div id="items">
    <div id="items-label">아이템</div>
    <div class="item-slot"></div>
    <div class="item-slot"></div>
    <div class="item-slot"></div>
    <div class="item-slot"></div>
  </div>
  <div id="event-log">
    <div id="log"></div>
    <div id="choices"></div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", ()=>{
const log=document.getElementById("log");
const choices=document.getElementById("choices");
const bgm=document.getElementById("bgm");
const bgmToggle=document.getElementById("bgm-toggle");
const gameContainer=document.getElementById("gameContainer");
const startBtn=document.getElementById("startGameBtn");
let isBGMPlaying=false;

let player={hp:300,maxHp:350,attack:100,defense:50,zone:1};
const characters={player:"images/player.png", npc:"images/npc.png"};
const possibleEvents=["monster","ally","box"];
let zoneEvents=[];
const zones={1:{monsterHp:200, monsterAtk:20},2:{monsterHp:300, monsterAtk:30},3:{monsterHp:400, monsterAtk:40},4:{monsterHp:0, monsterAtk:0}};
let monster={hp:0,maxHp:0,attack:0};

function writeMessage(text,speaker="npc",imgSrc=null){
  const msgDiv=document.createElement("div");
  msgDiv.className="message "+(speaker==="player"?"player":"");
  const img=document.createElement("img"); img.src=imgSrc||characters[speaker];
  const bubble=document.createElement("div"); bubble.className="bubble"; bubble.innerText=text;
  msgDiv.appendChild(img); msgDiv.appendChild(bubble);
  log.appendChild(msgDiv);
  log.scrollTop=log.scrollHeight;
}

function setChoices(options){
  choices.innerHTML="";
  options.forEach(opt=>{
    const btn=document.createElement("button");
    btn.innerText=opt.text; btn.onclick=()=>{ opt.action(); };
    choices.appendChild(btn);
  });
}

function updateStats(){
  document.getElementById("player-hp").innerText=`체력: ${player.hp} / ${player.maxHp}`;
  document.getElementById("monster-health-inner").style.width=`${monster.maxHp? (monster.hp/monster.maxHp*100) : 0}%`;
}

function addItemToSlot(imgSrc){
  const itemSlots=document.querySelectorAll(".item-slot");
  for(const slot of itemSlots){ 
    if(!slot.innerHTML){ 
      const img=document.createElement("img"); img.src=imgSrc; img.style.width="80px"; img.style.height="80px"; slot.appendChild(img); break; 
    } 
  }
}

function setZoneDisplay(){ document.getElementById("zone-display").innerText=`현재 위치: ${player.zone}구역`; }

bgmToggle.onclick=()=>{
  if(isBGMPlaying){ bgm.pause(); bgmToggle.innerText="🔇"; isBGMPlaying=false; } 
  else { bgm.play().catch(()=>{}); bgmToggle.innerText="🔊"; isBGMPlaying=true; }
};

function generateRandomEvents(){
  zoneEvents=[];
  for(let i=0;i<4;i++){
    const randIndex=Math.floor(Math.random()*possibleEvents.length);
    zoneEvents.push({type:possibleEvents[randIndex]});
  }
}

function nextZone(){ 
  player.zone++; 
  if(player.zone>zoneEvents.length){ writeMessage("모든 구역 클리어!","npc"); player.zone=1; } 
  startZoneEvent(); 
}

function startZoneEvent(){
  log.innerHTML=""; setZoneDisplay();
  const event=zoneEvents[player.zone-1];
  const monsterDiv=document.getElementById("monster");
  const monsterImg=monsterDiv.querySelector("img");
  const monsterHealthDiv=document.getElementById("monster-health");

  monsterHealthDiv.style.display="none"; // 몬스터 체력바 숨김 기본

  if(event.type==="monster"){
    monster.maxHp=zones[player.zone].monsterHp; monster.hp=monster.maxHp; monster.attack=zones[player.zone].monsterAtk;
    monsterImg.src="images/monster.png"; monsterHealthDiv.style.display="block";
    updateStats();
    writeMessage(`구역 ${player.zone}에서 유령이 나타났습니다!`,"npc");
    setChoices([{text:"공격", action:attack},{text:"도망", action:flee}]);
  } else if(event.type==="ally"){
    monsterImg.src="images/ally.png"; monsterImg.classList.remove("blink");
    writeMessage("조우자를 만났습니다!","npc");
    setChoices([
      {text:"대화하기", action:()=>{
        writeMessage("페로페로 ~ 체력이 50 회복되었습니다.","npc");
        player.hp=Math.min(player.hp+50,player.maxHp); updateStats();
        writeMessage("앗싸!","player"); 
        setChoices([{text:"다음 구역으로 가기", action:nextZone}]);
      }},
      {text:"그냥 지나가기", action:()=>{
        writeMessage("아쉬움을 뒤로 하고 다음 구역으로 이동하였습니다.","npc");
        setChoices([{text:"다음 구역으로 가기", action:nextZone}]);
      }}
    ]);
  } else if(event.type==="box"){
    monsterImg.src="images/box.png"; monsterImg.classList.add("blink");
    writeMessage("상자를 발견했습니다!","npc");
    setChoices([
      {text:"열기", action:()=>{
        monsterImg.classList.remove("blink");
        monsterImg.src="images/equipment.png"; // 상자 -> 장비 이미지
        addItemToSlot("images/equipment.png");
        writeMessage("상자를 열었습니다. 상자 속에서 [무지 캡 모자]를 획득하였습니다.","npc");
        setChoices([{text:"다음 구역으로 가기", action:nextZone}]);
      }},
      {text:"무시", action:()=>{
        writeMessage("아쉬움을 뒤로 하고 다음 구역으로 이동하였습니다.","npc");
        setChoices([{text:"다음 구역으로 가기", action:nextZone}]);
      }}
    ]);
  }
}

function attack(){
  if(player.hp<=0) return;
  let dmg=Math.max(player.attack-20,5); monster.hp-=dmg; if(monster.hp<0) monster.hp=0;
  writeMessage(`유령에게 ${dmg} 피해를 주었습니다!`,"player");
  updateStats();
  if(monster.hp<=0){
    writeMessage("유령을 처치했습니다!","npc");
    setChoices([{text:"다음 구역으로 가기", action:nextZone}]);
  } else {
    player.hp-=monster.attack; if(player.hp<0) player.hp=0;
    writeMessage(`유령에게 ${monster.attack} 피해를 받았습니다!`,"npc"); updateStats();
    if(player.hp<=0){ writeMessage("체력이 0이 되어 패배했습니다. 1구역으로 이동합니다.","npc"); player.hp=player.maxHp; player.zone=1; startZoneEvent(); }
  }
}

function flee(){ writeMessage("도망쳤습니다.","player"); nextZone(); }

startBtn.onclick=()=>{
  gameContainer.style.display="grid"; startBtn.style.display="none";
  bgm.play().catch(()=>{}); bgmToggle.innerText="🔊"; isBGMPlaying=true;
  generateRandomEvents(); startZoneEvent();
};

});
</script>
</body>
</html>
